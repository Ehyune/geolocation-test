<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚´ ìœ„ì¹˜ ë§ˆì»¤ í‘œì‹œ - Naver Maps</title>
    
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=ft86q8n3df"></script>
    
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        
        button {
            padding: 12px 20px;
            background-color: #03C75A;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover { background-color: #029f48; }

        #status { margin: 15px 0; font-weight: bold; color: #555; }
        
        /* ì§€ë„ ìŠ¤íƒ€ì¼: ë°˜ë“œì‹œ ë†’ì´(height)ë¥¼ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤ */
        #map {
            width: 100%;
            height: 500px;
            border: 1px solid #ddd;
            border-radius: 8px;
            display: none; /* ìœ„ì¹˜ ìˆ˜ì‹  ì „ì—ëŠ” ìˆ¨ê¹€ */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ í˜„ì¬ ìœ„ì¹˜ ì§€ë„ ë§ˆì»¤ ì˜ˆì œ</h1>
        <button onclick="startTracking()">ë‚´ ìœ„ì¹˜ í™•ì¸í•˜ê¸°</button>
        <div id="status">ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìœ„ì¹˜ ì¶”ì ì„ ì‹œì‘í•©ë‹ˆë‹¤.</div>
        
        <div id="map"></div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜ë¡œ mapê³¼ marker ì„ ì–¸ (ì¶”í›„ ì œì–´ë¥¼ ìœ„í•´)
        let map = null;
        let marker = null;

        function startTracking() {
            const statusDiv = document.getElementById('status');
            const mapDiv = document.getElementById('map');

            if (!navigator.geolocation) {
                statusDiv.innerHTML = "ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
                return;
            }

            statusDiv.innerHTML = "ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...";

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    // 1. ì¢Œí‘œ ì¶”ì¶œ
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    statusDiv.innerHTML = `ìœ„ì¹˜ í™•ì¸ ì™„ë£Œ: ìœ„ë„ ${lat.toFixed(5)}, ê²½ë„ ${lng.toFixed(5)}`;
                    
                    // 2. ì§€ë„ ì˜ì—­ í‘œì‹œ
                    mapDiv.style.display = 'block';

                    // 3. ë„¤ì´ë²„ ì§€ë„ ë° ë§ˆì»¤ ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œ
                    initNaverMap(lat, lng);
                },
                (error) => {
                    statusDiv.innerHTML = `ìœ„ì¹˜ í™•ì¸ ì‹¤íŒ¨: ${error.message}`;
                    console.error("Geolocation Error:", error);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        // ë„¤ì´ë²„ ì§€ë„ ì´ˆê¸°í™” ë° ë§ˆì»¤ ìƒì„± ë¡œì§ (ê³µì‹ ë¬¸ì„œ ê¸°ì¤€)
        function initNaverMap(lat, lng) {
            // ë„¤ì´ë²„ API ë¡œë“œ í™•ì¸
            if (typeof naver === 'undefined') {
                alert("ë„¤ì´ë²„ ì§€ë„ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. Client IDì™€ URL ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.");
                return;
            }

            // ì§€ë„ ì¤‘ì‹¬ ì¢Œí‘œ ê°ì²´ ìƒì„±
            const position = new naver.maps.LatLng(lat, lng);

            // 1. ì§€ë„ ìƒì„± (ê¸°ì¡´ ë§µì´ ì—†ìœ¼ë©´ ìƒì„±, ìˆìœ¼ë©´ ì¤‘ì‹¬ ì´ë™)
            if (!map) {
                map = new naver.maps.Map('map', {
                    center: position,
                    zoom: 16, // ì¤Œ ë ˆë²¨ (1~21)
                    minZoom: 10,
                    zoomControl: true,
                    zoomControlOptions: {
                        position: naver.maps.Position.TOP_RIGHT
                    }
                });
            } else {
                map.setCenter(position); // ì´ë¯¸ ì§€ë„ê°€ ìˆë‹¤ë©´ ì¤‘ì‹¬ë§Œ ì´ë™
            }

            // 2. ë§ˆì»¤ ìƒì„±
            if (!marker) {
                marker = new naver.maps.Marker({
                    position: position,
                    map: map,
                    title: "í˜„ì¬ ë‚´ ìœ„ì¹˜",
                    // ë§ˆì»¤ ì• ë‹ˆë©”ì´ì…˜ (ì„ íƒì‚¬í•­)
                    animation: naver.maps.Animation.DROP 
                });
            } else {
                marker.setPosition(position); // ê¸°ì¡´ ë§ˆì»¤ ìœ„ì¹˜ ì´ë™
            }

            // 3. (ì˜µì…˜) ì •ë³´ì°½ ë„ìš°ê¸°
            const contentString = [
                '<div style="padding:10px;min-width:150px;line-height:150%;">',
                '<h4 style="margin-top:5px;">ë‚´ ìœ„ì¹˜</h4>',
                '<p>ì—¬ê¸° ê³„ì‹œêµ°ìš”!</p>',
                '</div>'
            ].join('');

            const infoWindow = new naver.maps.InfoWindow({
                content: contentString,
                borderWidth: 1,
                anchorSkew: true
            });

            infoWindow.open(map, marker);
        }
    </script>
</body>
</html>